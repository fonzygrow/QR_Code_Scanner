<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>QR Code Scanner with Camera Selector</title>
  <style>
    video {
      width: 100%;
      height: auto;
    }
    select {
      margin-bottom: 10px;
      padding: 5px;
    }
  </style>
</head>
<body>
  <h1>QR Code Scanner</h1>
  <select id="cameraSelect">
    <option disabled selected>Select a camera</option>
  </select>
  <br />
  <video id="video" autoplay playsinline></video>

  <script>
    let videoStream = null;
    const videoElement = document.getElementById('video');
    const cameraSelect = document.getElementById('cameraSelect');

    // Retrieve all available video devices (cameras)
    navigator.mediaDevices.enumerateDevices()
      .then(devices => {
        const videoDevices = devices.filter(device => device.kind === 'videoinput');
        
        // Populate the dropdown menu with the available cameras
        videoDevices.forEach(device => {
          const option = document.createElement('option');
          option.value = device.deviceId;
          option.textContent = device.label || `Camera ${cameraSelect.length + 1}`;
          cameraSelect.appendChild(option);
        });

        // Start the video stream with the first available camera by default
        if (videoDevices.length > 0) {
          startCamera(videoDevices[0].deviceId);
        }

        // Switch camera when the user selects a different one
        cameraSelect.addEventListener('change', (event) => {
          const selectedDeviceId = event.target.value;
          startCamera(selectedDeviceId);
        });
      })
      .catch(err => {
        console.error('Error enumerating devices: ', err);
        document.body.innerHTML += "<p>Error enumerating devices: " + err.message + "</p>";
      });

    // Function to start the camera with the selected device ID
    function startCamera(deviceId) {
      // Stop any existing video stream before starting a new one
      if (videoStream) {
        videoStream.getTracks().forEach(track => track.stop());
      }

      // Get the selected video device
      navigator.mediaDevices.getUserMedia({
        video: { deviceId: deviceId }
      })
      .then(stream => {
        videoStream = stream;
        videoElement.srcObject = stream;
      })
      .catch(err => {
        console.error('Error accessing camera: ', err);
        document.body.innerHTML += "<p>Error accessing camera: " + err.message + "</p>";
      });
    }
  </script>
</body>
</html>
